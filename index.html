<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frankfurter WertpapierbÃ¶rse - ëª¨ì˜ì£¼ì‹ í”Œë«í¼</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #121826;
            --bg-tertiary: #1a2234;
            --accent-green: #00ff88;
            --accent-red: #ff3366;
            --accent-blue: #00d4ff;
            --accent-purple: #a855f7;
            --text-primary: #e8edf4;
            --text-secondary: #8b95a8;
            --border-color: #2a3547;
            --glow-green: rgba(0, 255, 136, 0.3);
            --glow-red: rgba(255, 51, 102, 0.3);
            --glow-blue: rgba(0, 212, 255, 0.3);
        }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Animated Background Grid */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(42, 53, 71, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(42, 53, 71, 0.3) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 20s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        .container {
            position: relative;
            z-index: 1;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 30px;
            animation: slideDown 0.8s ease;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--text-primary);
            letter-spacing: 2px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-eagle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            filter: brightness(1.1) contrast(1.05);
            border: 2px solid var(--accent-blue);
            box-shadow: 0 0 15px var(--glow-blue);
        }

        .user-info {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .balance {
            text-align: right;
        }

        .balance-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-green);
            text-shadow: 0 0 20px var(--glow-green);
        }

        .rank-badge {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 0 20px var(--glow-blue);
        }

        /* Main Grid Layout */
        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Stock List Panel */
        .stock-list {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            height: fit-content;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .panel-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            color: var(--accent-blue);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 10px;
        }

        .stock-item {
            padding: 15px;
            margin-bottom: 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stock-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, var(--glow-blue), transparent);
            transition: left 0.5s;
        }

        .stock-item:hover::before {
            left: 100%;
        }

        .stock-item:hover {
            border-color: var(--accent-blue);
            transform: translateX(5px);
            box-shadow: -5px 0 15px var(--glow-blue);
        }

        .stock-item.active {
            border-color: var(--accent-green);
            background: linear-gradient(90deg, var(--bg-tertiary), rgba(0, 255, 136, 0.1));
        }

        .stock-symbol {
            font-weight: 700;
            font-size: 1rem;
            color: var(--accent-blue);
            margin-bottom: 5px;
        }

        .stock-name {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .stock-price-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stock-price {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .stock-change {
            font-size: 0.85rem;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }

        .stock-change.up {
            color: var(--accent-green);
            background: rgba(0, 255, 136, 0.1);
        }

        .stock-change.down {
            color: var(--accent-red);
            background: rgba(255, 51, 102, 0.1);
        }

        /* Main Chart Area */
        .chart-area {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-stock-info h2 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            color: var(--accent-blue);
            margin-bottom: 5px;
        }

        .chart-stock-info .current-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .chart-stock-info .price-change {
            font-size: 1.2rem;
            margin-top: 5px;
        }

        .time-selector {
            display: flex;
            gap: 10px;
        }

        .time-btn {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .time-btn:hover, .time-btn.active {
            background: var(--accent-blue);
            color: var(--bg-primary);
            border-color: var(--accent-blue);
            box-shadow: 0 0 15px var(--glow-blue);
        }

        #stockChart {
            width: 100%;
            height: 400px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        /* Trading Panel */
        .trading-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .trade-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .trade-tab {
            flex: 1;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.85rem;
        }

        .trade-tab.buy:hover, .trade-tab.buy.active {
            background: var(--accent-green);
            color: var(--bg-primary);
            border-color: var(--accent-green);
            box-shadow: 0 0 20px var(--glow-green);
        }

        .trade-tab.sell:hover, .trade-tab.sell.active {
            background: var(--accent-red);
            color: var(--bg-primary);
            border-color: var(--accent-red);
            box-shadow: 0 0 20px var(--glow-red);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-field {
            width: 100%;
            padding: 14px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 15px var(--glow-blue);
        }

        .trade-summary {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .summary-row:last-child {
            margin-bottom: 0;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
            font-weight: 700;
        }

        .execute-btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
        }

        .execute-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .execute-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .execute-btn.buy {
            background: var(--accent-green);
            color: var(--bg-primary);
            box-shadow: 0 5px 20px var(--glow-green);
        }

        .execute-btn.buy:hover {
            box-shadow: 0 8px 30px var(--glow-green);
            transform: translateY(-2px);
        }

        .execute-btn.sell {
            background: var(--accent-red);
            color: var(--bg-primary);
            box-shadow: 0 5px 20px var(--glow-red);
        }

        .execute-btn.sell:hover {
            box-shadow: 0 8px 30px var(--glow-red);
            transform: translateY(-2px);
        }

        .portfolio-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .portfolio-item {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
        }

        .portfolio-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .portfolio-symbol {
            font-weight: 700;
            color: var(--accent-blue);
        }

        .portfolio-pl {
            font-weight: 600;
        }

        .portfolio-details {
            font-size: 0.8rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        /* Leaderboard Section */
        .leaderboard {
            margin-top: 30px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }

        .leaderboard-item:hover {
            border-color: var(--accent-purple);
            transform: translateX(5px);
        }

        .rank-number {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
            margin-right: 15px;
            border-radius: 50%;
        }

        .rank-number.first {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: var(--bg-primary);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .rank-number.second {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: var(--bg-primary);
        }

        .rank-number.third {
            background: linear-gradient(135deg, #cd7f32, #ffb347);
            color: var(--bg-primary);
        }

        .rank-number.other {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
        }

        .leaderboard-info {
            flex: 1;
        }

        .leaderboard-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .leaderboard-profit {
            font-size: 0.85rem;
        }

        /* Transfer Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--accent-blue);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-close:hover {
            color: var(--accent-red);
            transform: rotate(90deg);
        }

        .transfer-btn {
            padding: 12px 24px;
            background: var(--accent-purple);
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-left: 10px;
        }

        .transfer-btn:hover {
            box-shadow: 0 5px 20px var(--glow-blue);
            transform: translateY(-2px);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-purple);
        }

        /* Admin Panel */
        .admin-panel {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-purple);
            border-radius: 12px;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 8px 32px rgba(168, 85, 247, 0.3);
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .admin-btn {
            padding: 10px 20px;
            background: var(--accent-purple);
            border: none;
            border-radius: 6px;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.85rem;
        }

        .admin-btn:hover {
            box-shadow: 0 5px 20px rgba(168, 85, 247, 0.5);
            transform: translateY(-2px);
        }

        .admin-btn.danger {
            background: var(--accent-red);
        }

        .admin-btn.danger:hover {
            box-shadow: 0 5px 20px var(--glow-red);
        }

        .stock-admin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 6px;
            margin-bottom: 10px;
            border: 1px solid var(--border-color);
        }

        .delete-stock-btn {
            padding: 6px 12px;
            background: var(--accent-red);
            border: none;
            border-radius: 4px;
            color: white;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .delete-stock-btn:hover {
            box-shadow: 0 3px 10px var(--glow-red);
        }

        .admin-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background: var(--accent-purple);
            border: none;
            border-radius: 20px;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
        }

        .admin-toggle:hover {
            box-shadow: 0 5px 20px rgba(168, 85, 247, 0.5);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-secondary);
            border: 1px solid var(--accent-green);
            border-radius: 8px;
            padding: 16px 24px;
            box-shadow: 0 10px 40px var(--glow-green);
            display: none;
            animation: toastSlide 0.4s ease;
            z-index: 2000;
        }

        .toast.active {
            display: block;
        }

        @keyframes toastSlide {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .stock-list {
                max-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    
    <div class="container">
        <header>
            <div style="display: flex; flex-direction: column; gap: 5px;">
                <div class="logo">
                    <img src="logo.png" alt="FWB Logo" class="logo-eagle" onerror="this.style.display='none'">
                    FRANKFURTER WERTPAPIERBÃ–RSE
                </div>
                <div style="font-size: 0.7rem; color: var(--text-secondary); font-weight: 400; letter-spacing: 0.5px;">
                    Developed by Claude AI & Presented by E.W.Shosha
                </div>
            </div>
            <div class="user-info">
                <div class="balance">
                    <div class="balance-label">ì‚¬ìš©ì</div>
                    <div style="font-size: 1.1rem; font-weight: 600; color: var(--accent-blue);" id="currentUserId">Guest</div>
                </div>
                <div class="balance">
                    <div class="balance-label">ì´ ìì‚°</div>
                    <div class="balance-amount" id="totalBalance">â‚©10,000,000</div>
                </div>
                <div class="balance">
                    <div class="balance-label">í˜„ê¸ˆ</div>
                    <div class="balance-amount" id="cashBalance">â‚©10,000,000</div>
                </div>
                <div class="rank-badge">ìˆœìœ„ #<span id="userRank">1</span></div>
                <button class="transfer-btn" onclick="openTransferModal()">ê³„ì¢Œì†¡ê¸ˆ</button>
                <button class="transfer-btn" style="background: var(--accent-red);" onclick="deleteMyAccount()">ê³„ì¢Œì‚­ì œ</button>
                <button class="transfer-btn" style="background: var(--accent-purple);" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
        </header>

        <button class="admin-toggle" onclick="toggleAdmin()">ğŸ”§ ê´€ë¦¬ì ëª¨ë“œ</button>

        <div class="dashboard">
            <!-- Stock List Panel -->
            <div class="stock-list">
                <div class="panel-title">ğŸ“Š ì¢…ëª© ë¦¬ìŠ¤íŠ¸</div>
                <div id="stockListContainer"></div>
            </div>

            <!-- Chart Area -->
            <div class="chart-area">
                <div class="chart-header">
                    <div class="chart-stock-info">
                        <h2 id="chartSymbol">TECH-001</h2>
                        <div class="current-price" id="chartPrice">â‚©125,000</div>
                        <div class="price-change up" id="chartChange">+2,500 (+2.04%)</div>
                    </div>
                    <div class="time-selector">
                        <button class="time-btn active" data-range="1M">1ë¶„</button>
                        <button class="time-btn" data-range="30M">30ë¶„</button>
                        <button class="time-btn" data-range="1H">1ì‹œê°„</button>
                        <button class="time-btn" data-range="1D">1ì¼</button>
                        <button class="time-btn" data-range="1MO">1ê°œì›”</button>
                    </div>
                </div>
                <div id="stockChart">
                    <canvas class="chart-canvas" id="chartCanvas"></canvas>
                </div>
            </div>

            <!-- Trading Panel -->
            <div class="trading-panel">
                <div class="panel-title">ğŸ’° ë§¤ë§¤</div>
                <div class="trade-tabs">
                    <div class="trade-tab buy active" onclick="switchTab('buy')">ë§¤ìˆ˜</div>
                    <div class="trade-tab sell" onclick="switchTab('sell')">ë§¤ë„</div>
                </div>

                <div class="input-group">
                    <label class="input-label">ìˆ˜ëŸ‰</label>
                    <input type="number" class="input-field" id="tradeQuantity" value="1" min="1">
                </div>

                <div class="input-group">
                    <label class="input-label">ê°€ê²©</label>
                    <input type="number" class="input-field" id="tradePrice" value="125000" readonly>
                </div>

                <div class="trade-summary">
                    <div class="summary-row">
                        <span>ì£¼ë¬¸ ìˆ˜ëŸ‰:</span>
                        <span id="summaryQuantity">1 ì£¼</span>
                    </div>
                    <div class="summary-row">
                        <span>ì£¼ë¬¸ ë‹¨ê°€:</span>
                        <span id="summaryPrice">â‚©125,000</span>
                    </div>
                    <div class="summary-row">
                        <span>ì´ ì£¼ë¬¸ ê¸ˆì•¡:</span>
                        <span id="summaryTotal">â‚©125,000</span>
                    </div>
                </div>

                <button class="execute-btn buy" id="executeBtn" onclick="executeTrade()">
                    ë§¤ìˆ˜ ì£¼ë¬¸
                </button>

                <div class="portfolio-section">
                    <div class="panel-title">ğŸ“ˆ ë‚´ í¬íŠ¸í´ë¦¬ì˜¤</div>
                    <div id="portfolioContainer">
                        <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
                            ë³´ìœ  ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Leaderboard -->
        <div class="leaderboard">
            <div class="panel-title">ğŸ† ì‹¤ì‹œê°„ ë­í‚¹</div>
            <div id="leaderboardContainer"></div>
        </div>

        <!-- Admin Panel -->
        <div class="admin-panel" id="adminPanel" style="display: none;">
            <div class="admin-header">
                <div class="panel-title">ğŸ”§ ê´€ë¦¬ì íŒ¨ë„</div>
                <button class="admin-btn" onclick="changeAdminPassword()">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h3 style="color: var(--accent-purple); margin-bottom: 15px; font-size: 1rem;">ìƒˆ ê¸°ì—… ì¶”ê°€</h3>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 15px;">
                    <div class="input-group" style="margin-bottom: 0;">
                        <label class="input-label">ì‹¬ë³¼ (ì˜ˆ: TECH-009)</label>
                        <input type="text" class="input-field" id="newStockSymbol" placeholder="TECH-009">
                    </div>
                    <div class="input-group" style="margin-bottom: 0;">
                        <label class="input-label">ê¸°ì—…ëª…</label>
                        <input type="text" class="input-field" id="newStockName" placeholder="ìƒˆë¡œìš´ ê¸°ì—…">
                    </div>
                    <div class="input-group" style="margin-bottom: 0;">
                        <label class="input-label">ì´ˆê¸° ì£¼ê°€ (â‚©)</label>
                        <input type="number" class="input-field" id="newStockPrice" placeholder="100000" value="100000">
                    </div>
                    <div class="input-group" style="margin-bottom: 0;">
                        <label class="input-label">ì„¹í„°</label>
                        <select class="input-field" id="newStockSector">
                            <option value="technology">Technology</option>
                            <option value="finance">Finance</option>
                            <option value="biotech">Biotech</option>
                            <option value="automotive">Automotive</option>
                            <option value="energy">Energy</option>
                            <option value="entertainment">Entertainment</option>
                            <option value="food">Food</option>
                            <option value="realestate">Real Estate</option>
                        </select>
                    </div>
                </div>
                <button class="admin-btn" onclick="addNewStock()">+ ê¸°ì—… ì¶”ê°€</button>
            </div>

            <div>
                <h3 style="color: var(--accent-red); margin-bottom: 15px; font-size: 1rem;">ê¸°ì—… ê´€ë¦¬</h3>
                <div id="adminStockList"></div>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="color: var(--accent-purple); margin-bottom: 15px; font-size: 1rem;">ğŸ‘¥ ì‚¬ìš©ì ê´€ë¦¬</h3>
                <div id="adminUserList"></div>
            </div>
        </div>
    </div>

    <!-- Transfer Modal -->
    <div class="modal" id="transferModal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeTransferModal()">Ã—</button>
            <div class="modal-header">ê³„ì¢Œ ì†¡ê¸ˆ</div>
            
            <div style="background: var(--bg-tertiary); padding: 12px; border-radius: 6px; margin-bottom: 15px; border: 1px solid var(--accent-purple);">
                <div style="font-size: 0.85rem; color: var(--accent-purple); font-weight: 600;">ğŸ’³ ì†¡ê¸ˆ í•œë„: ìµœëŒ€ â‚©1,000,000</div>
            </div>
            
            <div class="input-group">
                <label class="input-label">ë°›ëŠ” ì‚¬ëŒ ID</label>
                <input type="text" class="input-field" id="recipientId" placeholder="ì‚¬ìš©ì ID ì…ë ¥">
            </div>

            <div class="input-group">
                <label class="input-label">ì†¡ê¸ˆ ê¸ˆì•¡</label>
                <input type="number" class="input-field" id="transferAmount" placeholder="ê¸ˆì•¡ ì…ë ¥ (ìµœëŒ€ 1,000,000)" min="1000" max="1000000">
            </div>

            <button class="execute-btn buy" onclick="executeTransfer()">ì†¡ê¸ˆí•˜ê¸°</button>
        </div>
    </div>

    <!-- Login/Signup Modal -->
    <div class="modal" id="loginModal" style="display: flex;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header" id="authTitle">ë¡œê·¸ì¸</div>
            
            <div id="loginForm">
                <div class="input-group">
                    <label class="input-label">ì‚¬ìš©ì ID</label>
                    <input type="text" class="input-field" id="loginUserId" placeholder="ID ì…ë ¥">
                </div>

                <div class="input-group">
                    <label class="input-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="input-field" id="loginPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                </div>

                <button class="execute-btn buy" onclick="loginUser()" style="margin-bottom: 10px;">ë¡œê·¸ì¸</button>
                <button class="execute-btn" onclick="switchToSignup()" style="background: var(--accent-purple);">íšŒì›ê°€ì…</button>
            </div>

            <div id="signupForm" style="display: none;">
                <div class="input-group">
                    <label class="input-label">ì‚¬ìš©ì ID</label>
                    <input type="text" class="input-field" id="signupUserId" placeholder="ID ì…ë ¥ (4ì ì´ìƒ)">
                </div>

                <div class="input-group">
                    <label class="input-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" class="input-field" id="signupPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (4ì ì´ìƒ)">
                </div>

                <div class="input-group">
                    <label class="input-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" class="input-field" id="signupPasswordConfirm" placeholder="ë¹„ë°€ë²ˆí˜¸ ë‹¤ì‹œ ì…ë ¥">
                </div>

                <button class="execute-btn buy" onclick="signupUser()" style="margin-bottom: 10px;">íšŒì›ê°€ì…</button>
                <button class="execute-btn" onclick="switchToLogin()" style="background: var(--accent-purple);">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Firebase Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <script>
// ============================================
// Firebase ì„¤ì •
// ============================================
const firebaseConfig = {
    apiKey: "AIzaSyDczRJGqLpJ9xlLWPTFkOZU2tC3tMRvA1U",
    authDomain: "stock-game-c3cad.firebaseapp.com",
    databaseURL: "https://stock-game-c3cad-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "stock-game-c3cad",
    storageBucket: "stock-game-c3cad.firebasestorage.app",
    messagingSenderId: "638224580097",
    appId: "1:638224580097:web:010c218bdc3460e57a8a00",
    measurementId: "G-CKBNG8ZXYQ"
};

// Firebase ì´ˆê¸°í™”
let database;
try {
    firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    console.log('âœ… Firebase ì—°ê²° ì„±ê³µ!');
} catch (error) {
    console.error('âŒ Firebase ì—°ê²° ì‹¤íŒ¨:', error);
    alert('âš ï¸ Firebase ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤!');
}

// ============================================
// ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
// ============================================
let ADMIN_PASSWORD = "admin1234";

// ============================================
// ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
// ============================================
let currentUser = null;
let stocks = [];

const INITIAL_STOCKS = [
    { symbol: 'TECH-001', name: 'ë„¤ì˜¤í…Œí¬', price: 125000, change: 0, sector: 'technology' },
    { symbol: 'FINC-002', name: 'í“¨ì²˜ë±…í¬', price: 89500, change: 0, sector: 'finance' },
    { symbol: 'BIO-003', name: 'ë°”ì´ì˜¤ì  ', price: 234000, change: 0, sector: 'biotech' },
    { symbol: 'AUTO-004', name: 'ìŠ¤ë§ˆíŠ¸ì¹´', price: 67800, change: 0, sector: 'automotive' },
    { symbol: 'ENR-005', name: 'ê·¸ë¦°ì—ë„ˆì§€', price: 145000, change: 0, sector: 'energy' },
    { symbol: 'GAME-006', name: 'ë„¥ìŠ¤íŠ¸ê²Œì„ì¦ˆ', price: 98700, change: 0, sector: 'entertainment' },
    { symbol: 'FOOD-007', name: 'í“¨ì „í‘¸ë“œ', price: 52300, change: 0, sector: 'food' },
    { symbol: 'REAL-008', name: 'ë©”íŠ¸ë¡œë¶€ë™ì‚°', price: 187000, change: 0, sector: 'realestate' },
];

let currentStock = null;
let tradeMode = 'buy';
let userCash = 10000000;
let portfolio = {};
let chartInstance = null;
let leaderboard = [];
let isPriceUpdater = false;
let priceUpdateInterval = null;

// ============================================
// Firebase ì‹¤ì‹œê°„ ë™ê¸°í™” í•¨ìˆ˜
// ============================================
function subscribeToStocks() {
    if (!database) return;
    
    database.ref('stocks').on('value', (snapshot) => {
        const stocksData = snapshot.val();
        
        if (!stocksData) {
            console.log('ğŸ“Š ì£¼ì‹ ë°ì´í„° ì´ˆê¸°í™” ì¤‘...');
            initializeStocks();
        } else {
            stocks = Object.values(stocksData);
            console.log('âœ… ì£¼ì‹ ë°ì´í„° ë¡œë“œ:', stocks.length, 'ê°œ');
            
            if (!currentStock && stocks.length > 0) {
                currentStock = stocks[0];
            }
            
            renderStockList();
            if (currentStock) {
                selectStock(stocks.find(s => s.symbol === currentStock.symbol) || stocks[0]);
            }
            updatePortfolio();
            updateBalance();
        }
    });
}

async function initializeStocks() {
    if (!database) return;
    
    try {
        const stocksObj = {};
        INITIAL_STOCKS.forEach(stock => {
            stocksObj[stock.symbol] = stock;
        });
        
        await database.ref('stocks').set(stocksObj);
        console.log('âœ… ì£¼ì‹ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ!');
    } catch (error) {
        console.error('âŒ ì£¼ì‹ ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
    }
}

function subscribeToLeaderboard() {
    if (!database) return;
    
    database.ref('users').on('value', async (snapshot) => {
        const usersData = snapshot.val();
        
        if (!usersData) {
            leaderboard = [];
            renderLeaderboard();
            return;
        }
        
        const rankings = [];
        
        for (const userId in usersData) {
            const userData = usersData[userId];
            let totalAssets = userData.cash || 10000000;
            
            if (userData.portfolio) {
                for (const symbol in userData.portfolio) {
                    const stock = stocks.find(s => s.symbol === symbol);
                    if (stock) {
                        totalAssets += userData.portfolio[symbol].quantity * stock.price;
                    }
                }
            }
            
            const profit = totalAssets - 10000000;
            rankings.push({
                name: userId,
                profit: profit,
                isCurrentUser: userId === currentUser
            });
        }
        
        rankings.sort((a, b) => b.profit - a.profit);
        
        leaderboard = rankings;
        renderLeaderboard();
    });
}

async function checkPriceUpdaterRole() {
    if (!database) return;
    
    try {
        const updaterRef = database.ref('system/priceUpdater');
        
        const snapshot = await updaterRef.once('value');
        const currentUpdater = snapshot.val();
        
        if (!currentUpdater) {
            await updaterRef.set({
                userId: currentUser,
                timestamp: Date.now()
            });
            isPriceUpdater = true;
            console.log('âœ… ì£¼ê°€ ì—…ë°ì´íŠ¸ ë‹´ë‹¹ìë¡œ ì„ ì •ë¨');
            startPriceSimulation();
        } else {
            const timeDiff = Date.now() - currentUpdater.timestamp;
            if (timeDiff > 30000) {
                await updaterRef.set({
                    userId: currentUser,
                    timestamp: Date.now()
                });
                isPriceUpdater = true;
                console.log('âœ… ì£¼ê°€ ì—…ë°ì´íŠ¸ ë‹´ë‹¹ì ëŒ€ì²´ ì„ ì •ë¨');
                startPriceSimulation();
            } else {
                isPriceUpdater = false;
                console.log('ğŸ“Š ì£¼ê°€ ì—…ë°ì´íŠ¸ëŠ” ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ë‹´ë‹¹ ì¤‘');
            }
        }
        
        if (isPriceUpdater) {
            setInterval(async () => {
                try {
                    await updaterRef.update({
                        timestamp: Date.now()
                    });
                } catch (error) {
                    console.error('ìƒì¡´ ì‹ í˜¸ ì „ì†¡ ì‹¤íŒ¨:', error);
                }
            }, 5000);
        }
    } catch (error) {
        console.error('ì£¼ê°€ ì—…ë°ì´í„° í™•ì¸ ì‹¤íŒ¨:', error);
    }
}

// ============================================
// ì´ˆê¸°í™” í•¨ìˆ˜
// ============================================
async function init() {
    const savedUser = localStorage.getItem('fwb_currentUser');
    if (savedUser && database) {
        currentUser = savedUser;
        await loadUserData();
        document.getElementById('loginModal').style.display = 'none';
    } else {
        document.getElementById('loginModal').style.display = 'flex';
        return;
    }

    subscribeToStocks();
    subscribeToLeaderboard();
    await checkPriceUpdaterRole();
    renderAdminStockList();
    
    setInterval(() => {
        console.log('ğŸ”„ 1ë¶„ ê²½ê³¼ - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
        location.reload();
    }, 60000);
    
    console.log('âœ… ìë™ ìƒˆë¡œê³ ì¹¨ í™œì„±í™” (1ë¶„ë§ˆë‹¤)');
}

async function loadUserData() {
    if (!currentUser || !database) {
        currentUser = null;
        userCash = 10000000;
        portfolio = {};
        return;
    }

    try {
        const snapshot = await database.ref('users/' + currentUser).once('value');
        const userData = snapshot.val();
        
        if (!userData) {
            userCash = 10000000;
            portfolio = {};
        } else {
            userCash = userData.cash || 10000000;
            portfolio = userData.portfolio || {};
        }
        
        document.getElementById('currentUserId').textContent = currentUser;
        updateBalance();
        updatePortfolio();
    } catch (error) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        showToast('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

async function saveUserData() {
    if (!currentUser || !database) return;

    try {
        await database.ref('users/' + currentUser).update({
            cash: userCash,
            portfolio: portfolio,
            lastUpdate: new Date().toISOString()
        });
    } catch (error) {
        console.error('ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
        showToast('ë°ì´í„° ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

// ============================================
// ë¡œê·¸ì¸/íšŒì›ê°€ì… í•¨ìˆ˜
// ============================================
async function loginUser() {
    const userId = document.getElementById('loginUserId').value.trim();
    const password = document.getElementById('loginPassword').value;

    if (!userId || !password) {
        showToast('IDì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!', 'error');
        return;
    }

    if (!database) {
        showToast('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    try {
        const snapshot = await database.ref('users/' + userId).once('value');
        const userData = snapshot.val();

        if (!userData) {
            showToast('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤!', 'error');
            return;
        }

        if (userData.password !== password) {
            showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
            return;
        }

        currentUser = userId;
        localStorage.setItem('fwb_currentUser', userId);
        await loadUserData();
        
        document.getElementById('loginModal').style.display = 'none';
        document.getElementById('loginUserId').value = '';
        document.getElementById('loginPassword').value = '';
        
        subscribeToStocks();
        subscribeToLeaderboard();
        await checkPriceUpdaterRole();
        renderAdminStockList();
        
        showToast(`í™˜ì˜í•©ë‹ˆë‹¤, ${userId}ë‹˜!`, 'success');
    } catch (error) {
        console.error('ë¡œê·¸ì¸ ì‹¤íŒ¨:', error);
        showToast('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

async function signupUser() {
    const userId = document.getElementById('signupUserId').value.trim();
    const password = document.getElementById('signupPassword').value;
    const passwordConfirm = document.getElementById('signupPasswordConfirm').value;

    if (!userId || userId.length < 4) {
        showToast('IDëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    if (!password || password.length < 4) {
        showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    if (password !== passwordConfirm) {
        showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
        return;
    }

    if (!database) {
        showToast('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    try {
        const snapshot = await database.ref('users/' + userId).once('value');
        
        if (snapshot.exists()) {
            showToast('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” IDì…ë‹ˆë‹¤!', 'error');
            return;
        }

        await database.ref('users/' + userId).set({
            password: password,
            cash: 10000000,
            portfolio: {},
            createdAt: new Date().toISOString()
        });

        showToast('íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'success');
        
        document.getElementById('signupUserId').value = '';
        document.getElementById('signupPassword').value = '';
        document.getElementById('signupPasswordConfirm').value = '';
        
        switchToLogin();
    } catch (error) {
        console.error('íšŒì›ê°€ì… ì‹¤íŒ¨:', error);
        showToast('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

function logout() {
    if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    saveUserData();
    
    if (isPriceUpdater && database) {
        database.ref('system/priceUpdater').remove();
        if (priceUpdateInterval) {
            clearInterval(priceUpdateInterval);
        }
    }
    
    currentUser = null;
    localStorage.removeItem('fwb_currentUser');
    location.reload();
}

function switchToSignup() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('signupForm').style.display = 'block';
    document.getElementById('authTitle').textContent = 'íšŒì›ê°€ì…';
}

function switchToLogin() {
    document.getElementById('signupForm').style.display = 'none';
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('authTitle').textContent = 'ë¡œê·¸ì¸';
}

// ============================================
// UI ë Œë”ë§ í•¨ìˆ˜
// ============================================
function renderStockList() {
    const container = document.getElementById('stockListContainer');
    if (!stocks || stocks.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">ì£¼ì‹ ë°ì´í„° ë¡œë”© ì¤‘...</div>';
        return;
    }
    
    container.innerHTML = stocks.map(stock => `
        <div class="stock-item ${currentStock && stock.symbol === currentStock.symbol ? 'active' : ''}" 
             onclick='selectStock(${JSON.stringify(stock)})'>
            <div class="stock-symbol">${stock.symbol}</div>
            <div class="stock-name">${stock.name}</div>
            <div class="stock-price-info">
                <span class="stock-price">â‚©${stock.price.toLocaleString()}</span>
                <span class="stock-change ${stock.change >= 0 ? 'up' : 'down'}">
                    ${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%
                </span>
            </div>
        </div>
    `).join('');
}

function selectStock(stock) {
    currentStock = stock;
    document.getElementById('chartSymbol').textContent = stock.symbol;
    document.getElementById('chartPrice').textContent = `â‚©${stock.price.toLocaleString()}`;
    document.getElementById('chartChange').textContent = 
        `${stock.change >= 0 ? '+' : ''}${(stock.price * stock.change / 100).toLocaleString()} (${stock.change >= 0 ? '+' : ''}${stock.change.toFixed(2)}%)`;
    document.getElementById('chartChange').className = `price-change ${stock.change >= 0 ? 'up' : 'down'}`;
    document.getElementById('tradePrice').value = stock.price;
    
    renderStockList();
    updateChart();
    updateTradeSummary();
}

function updateChart() {
    if (!currentStock) return;
    
    const activeTimeBtn = document.querySelector('.time-btn.active');
    const timeRange = activeTimeBtn ? activeTimeBtn.getAttribute('data-range') : '1M';
    
    let dataPoints, labels, timeFormat;
    const now = new Date();
    const basePrice = currentStock.price;
    
    switch(timeRange) {
        case '1M':
            dataPoints = 5;
            labels = ['4ë¶„ì „', '3ë¶„ì „', '2ë¶„ì „', '1ë¶„ì „', 'í˜„ì¬'];
            timeFormat = '4ë¶„ê°„ ì¶”ì´';
            break;
        case '30M':
            dataPoints = 5;
            labels = ['120ë¶„ì „', '90ë¶„ì „', '60ë¶„ì „', '30ë¶„ì „', 'í˜„ì¬'];
            timeFormat = '2ì‹œê°„ ì¶”ì´';
            break;
        case '1H':
            dataPoints = 5;
            labels = ['4ì‹œê°„ì „', '3ì‹œê°„ì „', '2ì‹œê°„ì „', '1ì‹œê°„ì „', 'í˜„ì¬'];
            timeFormat = '4ì‹œê°„ ì¶”ì´';
            break;
        case '1D':
            dataPoints = 5;
            labels = ['4ì¼ì „', '3ì¼ì „', '2ì¼ì „', '1ì¼ì „', 'í˜„ì¬'];
            timeFormat = '4ì¼ê°„ ì¶”ì´';
            break;
        case '1MO':
            dataPoints = 5;
            labels = ['4ê°œì›”ì „', '3ê°œì›”ì „', '2ê°œì›”ì „', '1ê°œì›”ì „', 'í˜„ì¬'];
            timeFormat = '4ê°œì›” ì¶”ì´';
            break;
        default:
            dataPoints = 5;
            labels = ['4ë¶„ì „', '3ë¶„ì „', '2ë¶„ì „', '1ë¶„ì „', 'í˜„ì¬'];
            timeFormat = 'ê¸°ë³¸';
    }
    
    // Firebaseì—ì„œ ì‹¤ì œ íˆìŠ¤í† ë¦¬ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    let data = [];
    
    if (database && currentStock) {
        const historyKey = `history_${timeRange}`;
        const historyRef = database.ref(`stocks/${currentStock.symbol}/${historyKey}`);
        
        historyRef.once('value').then((snapshot) => {
            const historyData = snapshot.val();
            
            if (historyData && historyData.prices && historyData.prices.length > 0) {
                // Firebaseì— ì €ì¥ëœ ì‹¤ì œ íˆìŠ¤í† ë¦¬ ì‚¬ìš©
                data = historyData.prices.slice(-dataPoints); // ìµœê·¼ dataPointsê°œë§Œ
                
                // ë¶€ì¡±í•˜ë©´ í˜„ì¬ ê°€ê²©ìœ¼ë¡œ ì±„ìš°ê¸°
                while (data.length < dataPoints) {
                    data.unshift(basePrice * 0.98);
                }
            } else {
                // íˆìŠ¤í† ë¦¬ê°€ ì—†ìœ¼ë©´ ì„ì‹œ ë°ì´í„° ìƒì„±
                let price = basePrice * 0.95;
                for (let i = 0; i < dataPoints - 1; i++) {
                    const randomChange = (Math.random() - 0.5) * (basePrice * 0.03);
                    price = Math.max(1000, price + randomChange);
                    data.push(price);
                }
                data.push(basePrice);
            }
            
            // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
            renderChart(data, labels, timeFormat);
        }).catch(() => {
            // ì—ëŸ¬ ì‹œ ì„ì‹œ ë°ì´í„° ìƒì„±
            let price = basePrice * 0.95;
            for (let i = 0; i < dataPoints - 1; i++) {
                const randomChange = (Math.random() - 0.5) * (basePrice * 0.03);
                price = Math.max(1000, price + randomChange);
                data.push(price);
            }
            data.push(basePrice);
            renderChart(data, labels, timeFormat);
        });
    } else {
        // Firebase ì—†ìœ¼ë©´ ì„ì‹œ ë°ì´í„°
        let price = basePrice * 0.95;
        for (let i = 0; i < dataPoints - 1; i++) {
            const randomChange = (Math.random() - 0.5) * (basePrice * 0.03);
            price = Math.max(1000, price + randomChange);
            data.push(price);
        }
        data.push(basePrice);
        renderChart(data, labels, timeFormat);
    }
}

function renderChart(data, labels, timeFormat) {
    const canvas = document.getElementById('chartCanvas');
    const ctx = canvas.getContext('2d');

    if (chartInstance) {
        chartInstance.destroy();
    }

    chartInstance = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: currentStock.symbol,
                data: data,
                borderColor: currentStock.change >= 0 ? '#00ff88' : '#ff3366',
                backgroundColor: currentStock.change >= 0 ? 
                    'rgba(0, 255, 136, 0.1)' : 'rgba(255, 51, 102, 0.1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointRadius: 1,
                pointHoverRadius: 5,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                title: {
                    display: true,
                    text: timeFormat,
                    color: '#8b95a8',
                    font: {
                        size: 11,
                        family: 'JetBrains Mono'
                    },
                    padding: {
                        top: 5,
                        bottom: 15
                    }
                },
                tooltip: {
                    backgroundColor: '#1a2234',
                    titleColor: '#00d4ff',
                    bodyColor: '#e8edf4',
                    borderColor: '#2a3547',
                    borderWidth: 1,
                    callbacks: {
                        label: (context) => `â‚©${Math.round(context.parsed.y).toLocaleString()}`
                    }
                }
            },
            scales: {
                x: {
                    grid: { color: '#2a3547', display: false },
                    ticks: {
                        color: '#8b95a8',
                        font: {
                            size: 10,
                            family: 'JetBrains Mono'
                        }
                    }
                },
                y: {
                    grid: { color: '#2a3547' },
                    ticks: {
                        color: '#8b95a8',
                        font: {
                            size: 10,
                            family: 'JetBrains Mono'
                        },
                        callback: (value) => `â‚©${Math.round(value / 1000)}K`
                    }
                }
            }
        }
    });
}

function switchTab(mode) {
    tradeMode = mode;
    document.querySelectorAll('.trade-tab').forEach(tab => tab.classList.remove('active'));
    document.querySelector(`.trade-tab.${mode}`).classList.add('active');
    
    const btn = document.getElementById('executeBtn');
    btn.className = `execute-btn ${mode}`;
    btn.textContent = mode === 'buy' ? 'ë§¤ìˆ˜ ì£¼ë¬¸' : 'ë§¤ë„ ì£¼ë¬¸';
    
    updateTradeSummary();
}

function updateTradeSummary() {
    if (!currentStock) return;
    
    const quantity = parseInt(document.getElementById('tradeQuantity').value) || 0;
    const price = currentStock.price;
    const total = quantity * price;

    document.getElementById('summaryQuantity').textContent = `${quantity} ì£¼`;
    document.getElementById('summaryPrice').textContent = `â‚©${price.toLocaleString()}`;
    document.getElementById('summaryTotal').textContent = `â‚©${total.toLocaleString()}`;
}

document.getElementById('tradeQuantity').addEventListener('input', updateTradeSummary);

function executeTrade() {
    if (!currentStock) return;
    
    const quantity = parseInt(document.getElementById('tradeQuantity').value);
    const price = currentStock.price;
    const total = quantity * price;

    if (tradeMode === 'buy') {
        if (total > userCash) {
            showToast('í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
            return;
        }
        
        userCash -= total;
        if (!portfolio[currentStock.symbol]) {
            portfolio[currentStock.symbol] = {
                name: currentStock.name,
                quantity: 0,
                avgPrice: 0
            };
        }
        
        const holding = portfolio[currentStock.symbol];
        holding.avgPrice = ((holding.avgPrice * holding.quantity) + total) / (holding.quantity + quantity);
        holding.quantity += quantity;
        
        showToast(`${currentStock.symbol} ${quantity}ì£¼ ë§¤ìˆ˜ ì™„ë£Œ!`, 'success');
    } else {
        if (!portfolio[currentStock.symbol] || portfolio[currentStock.symbol].quantity < quantity) {
            showToast('ë³´ìœ  ìˆ˜ëŸ‰ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
            return;
        }
        
        userCash += total;
        portfolio[currentStock.symbol].quantity -= quantity;
        
        if (portfolio[currentStock.symbol].quantity === 0) {
            delete portfolio[currentStock.symbol];
        }
        
        showToast(`${currentStock.symbol} ${quantity}ì£¼ ë§¤ë„ ì™„ë£Œ!`, 'success');
    }

    updateBalance();
    updatePortfolio();
    saveUserData();
    document.getElementById('tradeQuantity').value = 1;
    updateTradeSummary();
}

function updateBalance() {
    document.getElementById('cashBalance').textContent = `â‚©${userCash.toLocaleString()}`;
    
    let portfolioValue = userCash;
    Object.keys(portfolio).forEach(symbol => {
        const stock = stocks.find(s => s.symbol === symbol);
        if (stock) {
            portfolioValue += portfolio[symbol].quantity * stock.price;
        }
    });
    
    document.getElementById('totalBalance').textContent = `â‚©${portfolioValue.toLocaleString()}`;
}

function updatePortfolio() {
    const container = document.getElementById('portfolioContainer');
    
    if (Object.keys(portfolio).length === 0) {
        container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">ë³´ìœ  ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
    }

    container.innerHTML = Object.keys(portfolio).map(symbol => {
        const holding = portfolio[symbol];
        const stock = stocks.find(s => s.symbol === symbol);
        if (!stock) return '';
        
        const currentValue = holding.quantity * stock.price;
        const costBasis = holding.quantity * holding.avgPrice;
        const profitLoss = currentValue - costBasis;
        const profitLossPercent = (profitLoss / costBasis) * 100;

        return `
            <div class="portfolio-item">
                <div class="portfolio-header">
                    <span class="portfolio-symbol">${symbol}</span>
                    <span class="portfolio-pl ${profitLoss >= 0 ? 'up' : 'down'}" style="color: ${profitLoss >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                        ${profitLoss >= 0 ? '+' : ''}â‚©${profitLoss.toLocaleString()} (${profitLossPercent.toFixed(2)}%)
                    </span>
                </div>
                <div class="portfolio-details">
                    <span>${holding.quantity}ì£¼ ë³´ìœ </span>
                    <span>í‰ë‹¨ â‚©${holding.avgPrice.toLocaleString()}</span>
                </div>
            </div>
        `;
    }).join('');
}

function renderLeaderboard() {
    const container = document.getElementById('leaderboardContainer');
    
    if (!leaderboard || leaderboard.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 20px;">ë­í‚¹ ë°ì´í„° ë¡œë”© ì¤‘...</div>';
        document.getElementById('userRank').textContent = '-';
        return;
    }
    
    const userRank = leaderboard.findIndex(l => l.isCurrentUser) + 1;
    document.getElementById('userRank').textContent = userRank || '-';

    container.innerHTML = leaderboard.slice(0, 10).map((user, index) => {
        const rankClass = index === 0 ? 'first' : index === 1 ? 'second' : index === 2 ? 'third' : 'other';
        return `
            <div class="leaderboard-item" style="${user.isCurrentUser ? 'border-color: var(--accent-blue);' : ''}">
                <div class="rank-number ${rankClass}">${index + 1}</div>
                <div class="leaderboard-info">
                    <div class="leaderboard-name">${user.name}${user.isCurrentUser ? ' (ë‚˜)' : ''}</div>
                    <div class="leaderboard-profit" style="color: ${user.profit >= 0 ? 'var(--accent-green)' : 'var(--accent-red)'}">
                        ${user.profit >= 0 ? '+' : ''}â‚©${user.profit.toLocaleString()}
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

function startPriceSimulation() {
    if (!isPriceUpdater || !database) return;
    
    console.log('ğŸš€ ì£¼ê°€ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ (1ë¶„ë§ˆë‹¤ ì—…ë°ì´íŠ¸)');
    
    if (priceUpdateInterval) {
        clearInterval(priceUpdateInterval);
    }
    
    priceUpdateInterval = setInterval(async () => {
        if (!isPriceUpdater) {
            clearInterval(priceUpdateInterval);
            return;
        }
        
        try {
            const updates = {};
            
            for (const stock of stocks) {
                // -5% ~ +5% ëœë¤ ë³€ë™
                const changePercent = (Math.random() * 10 - 5) / 100;
                const oldPrice = stock.price;
                const newPrice = Math.max(1000, stock.price * (1 + changePercent));
                const change = ((newPrice - oldPrice) / oldPrice) * 100;
                
                updates[`stocks/${stock.symbol}/price`] = Math.round(newPrice);
                updates[`stocks/${stock.symbol}/change`] = parseFloat(change.toFixed(2));
                
                // ê° íƒ€ì„í”„ë ˆì„ë³„ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
                const timeframes = ['1M', '30M', '1H', '1D', '1MO'];
                
                for (const tf of timeframes) {
                    const historyKey = `history_${tf}`;
                    const historyRef = database.ref(`stocks/${stock.symbol}/${historyKey}`);
                    
                    // ê¸°ì¡´ íˆìŠ¤í† ë¦¬ ê°€ì ¸ì˜¤ê¸°
                    const snapshot = await historyRef.once('value');
                    const historyData = snapshot.val();
                    let prices = historyData?.prices || [];
                    
                    // ìƒˆ ê°€ê²© ì¶”ê°€
                    prices.push(Math.round(newPrice));
                    
                    // ìµœëŒ€ ê°œìˆ˜ ì œí•œ (íƒ€ì„í”„ë ˆì„ë³„ë¡œ ë‹¤ë¥´ê²Œ)
                    let maxLength;
                    switch(tf) {
                        case '1M': maxLength = 10; break;     // 10ë¶„
                        case '30M': maxLength = 20; break;    // 10ì‹œê°„
                        case '1H': maxLength = 30; break;     // 30ì‹œê°„
                        case '1D': maxLength = 30; break;     // 30ì¼
                        case '1MO': maxLength = 12; break;    // 12ê°œì›”
                        default: maxLength = 10;
                    }
                    
                    // ì˜¤ë˜ëœ ë°ì´í„° ì œê±°
                    if (prices.length > maxLength) {
                        prices = prices.slice(-maxLength);
                    }
                    
                    updates[`stocks/${stock.symbol}/${historyKey}/prices`] = prices;
                    updates[`stocks/${stock.symbol}/${historyKey}/lastUpdate`] = Date.now();
                }
            }
            
            // Firebaseì— í•œ ë²ˆì— ì—…ë°ì´íŠ¸
            await database.ref().update(updates);
            console.log('ğŸ“ˆ ì£¼ê°€ ë° íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            
        } catch (error) {
            console.error('ì£¼ê°€ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
        }
    }, 60000); // 60ì´ˆ = 1ë¶„
}

// ============================================
// ê¸°íƒ€ ê¸°ëŠ¥
// ============================================
function openTransferModal() {
    document.getElementById('transferModal').classList.add('active');
}

function closeTransferModal() {
    document.getElementById('transferModal').classList.remove('active');
}

async function executeTransfer() {
    const recipientId = document.getElementById('recipientId').value.trim();
    const amount = parseInt(document.getElementById('transferAmount').value);

    if (!recipientId) {
        showToast('ë°›ëŠ” ì‚¬ëŒ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”!', 'error');
        return;
    }

    if (recipientId === currentUser) {
        showToast('ìê¸° ìì‹ ì—ê²ŒëŠ” ì†¡ê¸ˆí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
        return;
    }

    if (!database) {
        showToast('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    if (!amount || amount < 1000) {
        showToast('ì†¡ê¸ˆ ê¸ˆì•¡ì€ ìµœì†Œ 1,000ì› ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    if (amount > 1000000) {
        showToast('ì†¡ê¸ˆ í•œë„ëŠ” ìµœëŒ€ 1,000,000ì›ì…ë‹ˆë‹¤!', 'error');
        return;
    }

    if (amount > userCash) {
        showToast('í˜„ê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    try {
        const recipientSnapshot = await database.ref('users/' + recipientId).once('value');
        if (!recipientSnapshot.exists()) {
            showToast('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì…ë‹ˆë‹¤!', 'error');
            return;
        }

        const recipientData = recipientSnapshot.val();

        userCash -= amount;
        await saveUserData();

        await database.ref('users/' + recipientId).update({
            cash: (recipientData.cash || 10000000) + amount,
            lastUpdate: new Date().toISOString()
        });

        updateBalance();
        closeTransferModal();
        showToast(`${recipientId}ë‹˜ê»˜ â‚©${amount.toLocaleString()} ì†¡ê¸ˆ ì™„ë£Œ!`, 'success');
        
        document.getElementById('recipientId').value = '';
        document.getElementById('transferAmount').value = '';
    } catch (error) {
        console.error('ì†¡ê¸ˆ ì‹¤íŒ¨:', error);
        showToast('ì†¡ê¸ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.style.borderColor = type === 'success' ? 'var(--accent-green)' : 'var(--accent-red)';
    toast.style.boxShadow = type === 'success' ? '0 10px 40px var(--glow-green)' : '0 10px 40px var(--glow-red)';
    toast.classList.add('active');
    
    setTimeout(() => {
        toast.classList.remove('active');
    }, 3000);
}

document.querySelectorAll('.time-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        updateChart();
    });
});

// ============================================
// ê´€ë¦¬ì ê¸°ëŠ¥
// ============================================
function toggleAdmin() {
    const panel = document.getElementById('adminPanel');
    
    if (panel.style.display === 'none') {
        const inputPassword = prompt('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
        
        if (inputPassword === null) {
            return;
        }
        
        if (inputPassword === ADMIN_PASSWORD) {
            panel.style.display = 'block';
            renderAdminUserList();
            showToast('ê´€ë¦¬ì ëª¨ë“œ í™œì„±í™”!', 'success');
        } else {
            showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
        }
    } else {
        panel.style.display = 'none';
    }
}

function changeAdminPassword() {
    const currentPassword = prompt('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
    
    if (currentPassword !== ADMIN_PASSWORD) {
        showToast('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
        return;
    }
    
    const newPassword = prompt('ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
    
    if (!newPassword || newPassword.length < 4) {
        showToast('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤!', 'error');
        return;
    }
    
    const confirmPassword = prompt('ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”:');
    
    if (newPassword !== confirmPassword) {
        showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!', 'error');
        return;
    }
    
    ADMIN_PASSWORD = newPassword;
    showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
}

function renderAdminStockList() {
    const container = document.getElementById('adminStockList');
    if (!stocks || stocks.length === 0) {
        container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 12px;">ì£¼ì‹ ë°ì´í„° ë¡œë”© ì¤‘...</div>';
        return;
    }
    
    container.innerHTML = stocks.map(stock => `
        <div class="stock-admin-item">
            <div>
                <div style="font-weight: 700; color: var(--accent-blue);">${stock.symbol}</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary);">${stock.name} - â‚©${stock.price.toLocaleString()}</div>
            </div>
            <button class="delete-stock-btn" onclick="deleteStock('${stock.symbol}')">ì‚­ì œ</button>
        </div>
    `).join('');
}

async function renderAdminUserList() {
    const container = document.getElementById('adminUserList');
    
    if (!database) {
        container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 12px;">Firebase ì—°ê²° í•„ìš”</div>';
        return;
    }

    try {
        const snapshot = await database.ref('users').once('value');
        const usersData = snapshot.val();
        
        if (!usersData || Object.keys(usersData).length === 0) {
            container.innerHTML = '<div style="text-align: center; color: var(--text-secondary); padding: 12px;">ë“±ë¡ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤</div>';
            return;
        }

        const userList = Object.keys(usersData).map(userId => {
            const userData = usersData[userId];
            const cash = userData.cash || 10000000;
            
            return `
                <div class="stock-admin-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 700; color: var(--accent-blue);">${userId}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">í˜„ê¸ˆ: â‚©${cash.toLocaleString()}</div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="admin-btn" style="padding: 6px 12px; font-size: 0.75rem; background: var(--accent-green);" 
                                onclick="adminAddMoney('${userId}')">ğŸ’° ì…ê¸ˆ</button>
                        <button class="admin-btn" style="padding: 6px 12px; font-size: 0.75rem; background: var(--accent-purple);" 
                                onclick="adminWithdrawMoney('${userId}')">ğŸ’¸ ì¶œê¸ˆ</button>
                        <button class="delete-stock-btn" style="padding: 6px 12px;" 
                                onclick="adminDeleteUser('${userId}')">ğŸ—‘ï¸ ì‚­ì œ</button>
                    </div>
                </div>
            `;
        }).join('');

        container.innerHTML = userList;
    } catch (error) {
        console.error('ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
        container.innerHTML = '<div style="text-align: center; color: var(--accent-red); padding: 12px;">ë¡œë“œ ì‹¤íŒ¨</div>';
    }
}

async function adminAddMoney(userId) {
    const amount = parseInt(prompt(`${userId}ë‹˜ì˜ ê³„ì¢Œì— ì…ê¸ˆí•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”:`));
    
    if (!amount || amount <= 0) {
        showToast('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”!', 'error');
        return;
    }

    try {
        const snapshot = await database.ref('users/' + userId).once('value');
        const userData = snapshot.val();
        
        if (!userData) {
            showToast('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
            return;
        }

        const newCash = (userData.cash || 10000000) + amount;
        
        await database.ref('users/' + userId).update({
            cash: newCash,
            lastUpdate: new Date().toISOString()
        });

        showToast(`${userId}ë‹˜ê»˜ â‚©${amount.toLocaleString()} ì…ê¸ˆ ì™„ë£Œ!`, 'success');
        renderAdminUserList();
    } catch (error) {
        console.error('ì…ê¸ˆ ì‹¤íŒ¨:', error);
        showToast('ì…ê¸ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

async function adminWithdrawMoney(userId) {
    const amount = parseInt(prompt(`${userId}ë‹˜ì˜ ê³„ì¢Œì—ì„œ ì¶œê¸ˆí•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”:`));
    
    if (!amount || amount <= 0) {
        showToast('ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”!', 'error');
        return;
    }

    try {
        const snapshot = await database.ref('users/' + userId).once('value');
        const userData = snapshot.val();
        
        if (!userData) {
            showToast('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
            return;
        }

        const currentCash = userData.cash || 10000000;
        
        if (amount > currentCash) {
            if (!confirm(`${userId}ë‹˜ì˜ í˜„ê¸ˆ(â‚©${currentCash.toLocaleString()})ë³´ë‹¤ í° ê¸ˆì•¡ì…ë‹ˆë‹¤.\n\nê°•ì œë¡œ ì¶œê¸ˆí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì”ì•¡ì´ ìŒìˆ˜ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤)`)) {
                return;
            }
        }

        const newCash = currentCash - amount;
        
        await database.ref('users/' + userId).update({
            cash: newCash,
            lastUpdate: new Date().toISOString()
        });

        showToast(`${userId}ë‹˜ì—ê²Œì„œ â‚©${amount.toLocaleString()} ì¶œê¸ˆ ì™„ë£Œ!`, 'success');
        renderAdminUserList();
    } catch (error) {
        console.error('ì¶œê¸ˆ ì‹¤íŒ¨:', error);
        showToast('ì¶œê¸ˆ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

async function adminDeleteUser(userId) {
    if (userId === currentUser) {
        showToast('ìê¸° ìì‹ ì€ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!', 'error');
        return;
    }

    if (!confirm(`ì •ë§ë¡œ ${userId}ë‹˜ì˜ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`)) {
        return;
    }

    try {
        await database.ref('users/' + userId).remove();
        showToast(`${userId}ë‹˜ì˜ ê³„ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
        renderAdminUserList();
    } catch (error) {
        console.error('ê³„ì • ì‚­ì œ ì‹¤íŒ¨:', error);
        showToast('ê³„ì • ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

async function addNewStock() {
    const symbol = document.getElementById('newStockSymbol').value.trim();
    const name = document.getElementById('newStockName').value.trim();
    const price = parseInt(document.getElementById('newStockPrice').value) || 100000;
    const sector = document.getElementById('newStockSector').value;

    if (!symbol || !name) {
        showToast('ì‹¬ë³¼ê³¼ ê¸°ì—…ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
        return;
    }

    if (stocks.find(s => s.symbol === symbol)) {
        showToast('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‹¬ë³¼ì…ë‹ˆë‹¤!', 'error');
        return;
    }

    if (!database) {
        showToast('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    try {
        await database.ref('stocks/' + symbol).set({
            symbol: symbol,
            name: name,
            price: price,
            change: 0,
            sector: sector
        });

        showToast(`${name} (${symbol}) ì¶”ê°€ ì™„ë£Œ!`, 'success');

        document.getElementById('newStockSymbol').value = '';
        document.getElementById('newStockName').value = '';
        document.getElementById('newStockPrice').value = '100000';
    } catch (error) {
        console.error('ê¸°ì—… ì¶”ê°€ ì‹¤íŒ¨:', error);
        showToast('ê¸°ì—… ì¶”ê°€ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

async function deleteStock(symbol) {
    if (stocks.length <= 1) {
        showToast('ìµœì†Œ 1ê°œì˜ ê¸°ì—…ì€ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    const stock = stocks.find(s => s.symbol === symbol);
    if (!stock) return;

    if (!confirm(`ì •ë§ë¡œ ${stock.name} (${symbol})ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nëª¨ë“  ì‚¬ìš©ìì˜ í¬íŠ¸í´ë¦¬ì˜¤ì—ì„œ í•´ë‹¹ ì£¼ì‹ì´ í˜„ê¸ˆìœ¼ë¡œ í™˜ì‚°ë©ë‹ˆë‹¤.`)) {
        return;
    }

    if (!database) {
        showToast('Firebase ì—°ê²°ì´ í•„ìš”í•©ë‹ˆë‹¤!', 'error');
        return;
    }

    try {
        const usersSnapshot = await database.ref('users').once('value');
        const usersData = usersSnapshot.val();
        
        if (usersData) {
            for (const userId in usersData) {
                const userData = usersData[userId];
                if (userData.portfolio && userData.portfolio[symbol]) {
                    const refundAmount = userData.portfolio[symbol].quantity * stock.price;
                    const newCash = (userData.cash || 10000000) + refundAmount;
                    
                    delete userData.portfolio[symbol];
                    
                    await database.ref('users/' + userId).update({
                        cash: newCash,
                        portfolio: userData.portfolio
                    });
                }
            }
        }
        
        await database.ref('stocks/' + symbol).remove();
        
        showToast(`${stock.name} ì‚­ì œ ì™„ë£Œ!`, 'success');
        
        if (currentStock && currentStock.symbol === symbol && stocks.length > 1) {
            const remainingStocks = stocks.filter(s => s.symbol !== symbol);
            if (remainingStocks.length > 0) {
                selectStock(remainingStocks[0]);
            }
        }
    } catch (error) {
        console.error('ê¸°ì—… ì‚­ì œ ì‹¤íŒ¨:', error);
        showToast('ê¸°ì—… ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

async function deleteMyAccount() {
    if (!confirm('âš ï¸ ì •ë§ë¡œ ê³„ì¢Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ ì‚­ì œë©ë‹ˆë‹¤!')) {
        return;
    }

    const confirmText = prompt('ê³„ì¢Œ ì‚­ì œë¥¼ í™•ì¸í•˜ë ¤ë©´ "ì‚­ì œ"ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
    if (confirmText !== 'ì‚­ì œ') {
        showToast('ê³„ì¢Œ ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'error');
        return;
    }

    if (!database || !currentUser) {
        showToast('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
        return;
    }

    try {
        await database.ref('users/' + currentUser).remove();
        
        showToast('ê³„ì¢Œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì•„ì›ƒí•©ë‹ˆë‹¤.', 'success');
        
        setTimeout(() => {
            localStorage.removeItem('fwb_currentUser');
            location.reload();
        }, 2000);
    } catch (error) {
        console.error('ê³„ì¢Œ ì‚­ì œ ì‹¤íŒ¨:', error);
        showToast('ê³„ì¢Œ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!', 'error');
    }
}

// ì´ˆê¸°í™” ì‹¤í–‰
init();
    </script>
</body>
</html>
